(()=>{"use strict";const e=(e,t,o,l)=>({x:Math.floor(e/o.width*l.width),y:Math.floor(t/o.height*l.height)}),t=e=>`#${("00"+e.r.toString(16)).slice(-2)}${("00"+e.g.toString(16)).slice(-2)}${("00"+e.b.toString(16)).slice(-2)}`;let o;const l={r:0,g:0,b:0,a:255},n=e=>{const t=(o=e.target.value,(l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o))?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16),a:255}:null);var o,l;i(t.r,t.g,t.b,t.a)},r=()=>l,i=(e,t,o,n)=>{l.r=e,l.g=t,l.b=o,l.a=n},h=(e,t,o,l=255)=>({r:e,g:t,b:o,a:l});let a,c,g,d,s={};const u=(e,t,o)=>{if(e<0||e>=s.width||t<0||t>=s.height)return;let l=x(e,t,s.width);C(l,o,h(d[l],d[l+1],d[l+2],d[l+3])),d[l]=o.r,d[l+1]=o.g,d[l+2]=o.b,d[l+3]=o.a,c.putImageData(g,0,0)},m=(e,t)=>{e<0||e>=d.length||(d[e]=t.r,d[e+1]=t.g,d[e+2]=t.b,d[e+3]=t.a,c.putImageData(g,0,0))},p=(e,t,o,l,n)=>{let r=Math.abs(o-e),i=Math.abs(l-t),h=e<o?1:-1,a=t<l?1:-1,c=r-i;for(;e!==o||t!==l;){u(e,t,n);let o=2*c;o>-i&&(c-=i,e+=h),o<=r&&(c+=r,t+=a)}},x=(e,t,o)=>t*(4*o)+4*e;let y,w,f,b,S=[],I=[],q=[],v=0;const C=(e,t,o)=>{f||q.find((t=>t.pixelIndex===e))||(q.push({pixelIndex:e,toColor:{...t},fromColor:{...o}}),I=[],w=!0)},E=()=>{if(S.length<=0)return;let e=S.pop();if(null===e)return;f=!0,I.push(e);let t=e.changes;for(let e=0;e<t.length;e++){let o=t[e];m(o.pixelIndex,o.fromColor)}v--,f=!1,P()},$=()=>{if(I.length<=0)return;let e=I.pop();if(null===e)return;b=!0,S.push(e);let t=e.changes;for(let e=0;e<t.length;e++){let o=t[e];m(o.pixelIndex,o.toColor)}v++,b=!1,P()},P=()=>{for(;y.firstChild;)y.removeChild(y.firstChild);for(let e=0;e<S.length;e++){const t=document.createElement("p");t.innerText=`${S[e].changeNumber}. ${S[e].message}`,e===S.length-1&&(t.style.border="1px solid white"),y.append(t)}y.scrollTop=y.scrollHeight;for(let e=I.length-1;e>=0;e--){const t=document.createElement("p");t.innerText=`${I[e].changeNumber}. ${I[e].message}`,t.style.fontStyle="italic",t.style.color="#aaaaaa",y.append(t)}};let k,D,M,R,N,T={};const H=(t,o,l,n)=>{if(N="Erased Pixels...",null!=o){let r=e(t.x,t.y,l,n),i=e(o.x,o.y,l,n);p(r.x,r.y,i.x,i.y,h(0,0,0,0)),u(r.x,r.y,h(0,0,0,0))}},z=(o,l,n,i)=>{if(N=`Penciled Pixels as ${t(r())}...`,null!=l){let t=e(o.x,o.y,n,i),h=e(l.x,l.y,n,i);p(t.x,t.y,h.x,h.y,r()),u(t.x,t.y,r())}},A=(n,r,a,c)=>{let g=e(n.x,n.y,a,c);var u;u=((e,t)=>{if(e<0||e>=s.width||t<0||t>=s.height)return;let o=x(e,t,s.width);return h(d[o],d[o+1],d[o+2],d[o+3])})(g.x,g.y),i(u.r,u.g,u.b,u.a),o.value=t(l)},B=()=>{R=M.Eraser},F=()=>{R=M.Pencil},X=()=>{R=M.Dropper},Y={width:64,height:64},j={width:600,height:600};let G,J,K,L={x:-1,y:-1},O=!1;const Q=()=>{var e,t;requestAnimationFrame(Q),e=a,D.clearRect(0,0,T.width,T.height),D.save(),D.fillStyle="white",D.fillRect(0,0,T.width,T.height),D.restore(),D.drawImage(e,0,0,e.width,e.height,0,0,T.width,T.height),O&&((e,t,o,l)=>{R(e,t,o,l)})(L,K,j,Y),!O&&w&&(t=N,w=!1,S.push({time:Date.now(),changes:q,changeNumber:v+=1,message:t}),q=[],S.length>1e3&&S.shift(),P()),K=L},U=e=>{O=!0},V=e=>{O=!1},W=e=>{const t=J.getBoundingClientRect();L={x:e.clientX-t.x,y:e.clientY-t.y}};window.onload=()=>{var e,t,l;G=document.querySelector("#rawimage"),e=Y.width,t=Y.height,l=G,s.width=e,s.height=t,a=l,a.width=e,a.height=t,c=a.getContext("2d"),(()=>{g=c.createImageData(s.width,s.height),d=g.data;for(let e=0;e<d.length;e+=4)d[e]=0,d[e+1]=0,d[e+2]=0,d[e+3]=0;c.putImageData(g,0,0)})(),J=document.querySelector("#display"),((e,t,o)=>{window.devicePixelRatio,T.width=e,T.height=t,k=o,k.width=e,k.height=t,D=k.getContext("2d"),D.imageSmoothingEnabled=!1,D.mozImageSmoothingEnabled=!1,D.webkitImageSmoothingEnabled=!1,D.msImageSmoothingEnabled=!1})(j.width,j.height,J),o=document.querySelector("#colorPicker"),o.onchange=n,(()=>{const e=document.querySelector("#historyHolder");y=e.querySelector("#changes");const t=e.querySelector("#undo"),o=e.querySelector("#redo");t.onclick=E,o.onclick=$})(),document.querySelector("#eraser").onclick=B,document.querySelector("#pencil").onclick=F,document.querySelector("#dropper").onclick=X,M={Eraser:H,Pencil:z,Dropper:A},R=M.Pencil,J.onmousedown=U,document.onmouseup=V,document.onmousemove=W,J.touchstart=U,document.touchend=V,document.touchmove=W,Q()}})();